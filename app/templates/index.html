<!DOCTYPE html>
<html>
<head>
    <title>MyElectricalData</title>
    <!--	JQUERY-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
    <!--	JQUERY CONFIRM-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.css">
    <!--	LOADING PAGE-->
    <script src="https://cdn.jsdelivr.net/npm/gasparesganga-jquery-loading-overlay@2.1.7/dist/loadingoverlay.min.js"></script>
    <!--	DATATABLE-->
    <script type="text/javascript" charset="utf8"
            src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.js"></script>
    <script type="text/javascript" charset="utf8"
            src="https://cdn.datatables.net/plug-ins/1.12.1/sorting/custom-data-source/dom-text.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.css">
    <!--    NOTIFY-->
    <script src="https://rawgit.com/notifyjs/notifyjs/master/dist/notify.js"></script>
    <script src="/static/js/notif.js"></script>
    <link rel="stylesheet" href="/static/css/notif.css">
    <!--	GOOGLE FONT-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap">
    <!--	NICE SELECT-->
    <script src="/static/js/nice-select.js"></script>
    <link rel="stylesheet" href="/static/css/nice-select.css">
    <!--	MENU-->
    <script src="/static/js/menu.js"></script>
    <link rel="stylesheet" href="/static/css/menu.css">
    <!--    GOOGLE CHART-->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <!--    MATERIAL ICON-->
    <link href="/static/css/jquery-fab-button.min.css" rel="stylesheet">
    <script src="/static/js/jquery-fab-button.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <!--    POPUP -->
    <link href="/static/css/popup.css" rel="stylesheet">
    <script src="/static/js/popup.js"></script>
    <!--	STATIC-->
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="stylesheet" href="/static/css/logo.css">
    <!--	JQUERY VALIDATE-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/jquery.validate.min.js"></script>
    <script src="/static/js/validator_fr.js"></script>


    <script>
        $(document).ready(function () {
        {{ head }}
        $(".datatable_button").click(function () {
        let name = $(this).attr("name");
        let tag = $(this).attr("id").split("_")[0];
        let type = name.split("_")[0]
        let usage_point_id = name.split("_")[1]
        let date = name.split("_")[2]
        if (type === "import" || type === "reset") {
        // IMPORT OR RESET
        $(this).css("display", "none");
        url = '/usage_point_id/' + usage_point_id + '/' + tag + '/' + type + '/' + date
        $.ajax({
        type: 'GET',
        url: url
        })
        .done(function (data) {
        data = $.parseJSON(JSON.stringify(data))
        if (data_unittests.hasOwnProperty('error') && data['error'] === "true") {
        $('#' + tag + '_' + type + '_' + date).css("display", "block");
        data_unittests if (data.hasOwnProperty('notif')) {
        $.notify(data["notif"], {style: 'enedis', className: 'error'});
        }
        $('#' + tag + '_fail_count_' + date).html(data["result"]['fail_count']);
        } else {
        data_unittests if (data.hasOwnProperty('notif')) {
        $.notify(data["notif"], {style: 'enedis', className: 'success'});
        }
        if (type === "reset") {
        $('#' + tag + '_reset_' + date).css("display", "none");
        $('#' + tag + '_import_' + date).css("display", "block");
        $('#' + tag + '_icon_' + date).removeClass("icon_success");
        $('#' + tag + '_icon_' + date).addClass("icon_failed");
        $('#' + tag + '_conso_w_' + date).html("0 W");
        $('#' + tag + '_conso_kw_' + date).html("0 kW");
        $('#' + tag + '_fail_count_' + date).html(data["result"]['fail_count']);
        $('#' + tag + '_blacklist_' + date).css("display", "block");
        $('#' + tag + '_whitelist_' + date).css("display", "none")
        $('#' + tag + '_blacklist_' + date).removeClass("datatable_button_disable");
        } else {
        if (data["result"]["date"] === date) {
        $('#' + tag + '_reset_' + date).css("display", "block");
        $('#' + tag + '_import_' + date).css("display", "none");
        $('#' + tag + '_icon_' + date).removeClass("icon_failed");
        $('#' + tag + '_icon_' + date).addClass("icon_success");
        $('#' + tag + '_conso_w_' + date).html(data["result"]['value'] + " W");
        $('#' + tag + '_conso_kw_' + date).html(data["result"]['value'] / 1000 + " kW");
        $('#' + tag + '_fail_count_' + date).html(data["result"]['fail_count']);
        $('#' + tag + '_blacklist_' + date).css("display", "block");
        $('#' + tag + '_whitelist_' + date).css("display", "none");
        $('#' + tag + '_blacklist_' + date).addClass("datatable_button_disable");
        } else {
        $.notify("La donnÃ©e n'est pas disponible chez Enedis.", {
        style: 'enedis',
        className: 'error'
        });
        $('#' + tag + '_' + type + '_' + date).css("display", "block");
        }
        }
        }

        });
        } else {
        // BLACKLIST
        if (!$('#' + tag + '_' + type + '_' + date).hasClass("datatable_button_disable")) {
        url = '/usage_point_id/' + usage_point_id + '/' + tag + '/' + type + '/' + date
        $.ajax({
        type: 'GET',
        url: url
        })
        .done(function (data) {
        data = JSON.parse(JSON.stringify(data))
        data_unittests if (data.hasOwnProperty('error') && data['error'] === "true") {
        $('#' + tag + '_' + type + '_' + date).css("display", "block");
        data_unittests if (data.hasOwnProperty('notif')) {
        $.notify(data["notif"], {style: 'enedis', className: 'error'});
        }
        data_unittestslse {
        if (data.hasOwnProperty('notif')) {
        $.notify(data["notif"], {style: 'enedis', className: 'success'});
        }
        if (type === "blacklist") {
        $('#' + tag + '_blacklist_' + date).css("display", "none");
        $('#' + tag + '_whitelist_' + date).css("display", "block");
        $('#' + tag + '_icon_' + date).removeClass("icon_failed");
        $('#' + tag + '_icon_' + date).addClass("icon_success");
        $('#' + tag + '_conso_w_' + date).html("0 W");
        $('#' + tag + '_conso_kw_' + date).html("0 kW");
        $('#' + tag + '_reset_' + date).css("display", "block");
        $('#' + tag + '_import_' + date).css("display", "none");
        } else {
        $('#' + tag + '_blacklist_' + date).css("display", "block");
        $('#' + tag + '_whitelist_' + date).css("display", "none");
        $('#' + tag + '_icon_' + date).removeClass("icon_success");
        $('#' + tag + '_icon_' + date).addClass("icon_failed");
        $('#' + tag + '_reset_' + date).css("display", "none");
        $('#' + tag + '_import_' + date).css("display", "block");
        $('#' + tag + '_blacklist_' + date).removeClass("datatable_button_disable");
        }
        }
        });
        }
        }
        });
        $(".paypal_link").click(function () {
        $("#paypal_form").first().submit();
        });
        $('code').on('click', (e) => {
        var content = e.target.innerText
        copyToClipboard(content);
        $.notify(" Copie : " + content.slice(0, 30) + "..." + content.slice(-30), {
        style: 'enedis',
        className: 'success'
        });
        });
        $.notify.addStyle('enedis', {
        html: "</script>
</head>
<body style="margin: 0px">
<div id="config_url" style="display: none"></div>
<div id="configuration" title="{{ formTitle }}" style="display: none">
    <form id="formConfiguration" action="/configuration/{{usage_point_id}}" method="POST">
        {{ configuration }}
    </form>
</div>
<div class="side_menu">
    <div class="burger_box">
        <div class="menu-icon-container">
            <a href="#" class="menu-icon js-menu_toggle closed">
			<span class="menu-icon_box">
				<span class="menu-icon_line menu-icon_line--1"></span>
				<span class="menu-icon_line menu-icon_line--2"></span>
				<span class="menu-icon_line menu-icon_line--3"></span>
			</span>
            </a>
        </div>
    </div>
    <div class="container">
        <h2 class="menu_title">Menu</h2>
        <ul class="list_load">
            <li class="list_item"><a href="/">Accueil</a></li>
            <li class="list_item"><a style="cursor: pointer" class="alert_redirect" about="{{ concent_url }}">Consentement</a>
            </li>
            <li class="list_item"><a style="cursor: pointer" class="alert_redirect"
                                     about="{{ doc_url }}">Documentation</a></li>
            <li class="list_item"><a style="cursor: pointer" class="alert_redirect"
                                     about="{{ swagger_url }}">Swagger</a></li>
            <li class="list_item"><a style="cursor: pointer" class="alert_redirect" about="{{ redoc_url }}">Redoc</a>
            </li>
            <li class="list_item"><a style="cursor: pointer" class="alert_redirect" about="{{ code_url }}">Codes
                d'erreurs</a></li>
            <li class="list_item"><a style="cursor: pointer" class="alert_redirect" about="{{ faq_url }}">FAQ</a></li>
        </ul>
        <div class="spacer_box"><p>Liens</p></div>
        <ul id="menu_link" class="list_load">
            <li class="list_item"><a href="https://discord.gg/DfVJZme" style="display: inline-block;">
                <div>
                    <img style="vertical-align:middle; width: 18px" src="/static/img/discord.png" alt="Discord">
                    <span style="padding-left: 10px;">Discord</span>
                </div>
            </a>
            </li>
            <li class="list_item"><a href="https://mon-compte-client.enedis.fr" style="display: inline-block;">
                <div>
                    <img style="vertical-align:middle; width: 18px" src="/static/img/enedis.png" alt="Enedis">
                    <span style="padding-left: 10px;">Enedis</span>
                </div>
            </a>
            </li>
        </ul>
        <ul class="list_load">
            <li class="list_item">
                <div style="text-align: center" id="paypal" class="paypal_link">
                    <form action="https://www.paypal.com/donate" method="post" target="_top" style="height: 55px;"
                          id="paypal_form">
                        <input type="hidden" name="business" value="FY25JLXDYLXAJ"/>
                        <input type="hidden" name="no_recurring" value="0"/>
                        <input type="hidden" name="currency_code" value="EUR"/>
                        <input type="image" id="paypal_img"
                               src="/static/img/paypal.png"
                               border="0"
                               name="submit"
                               title="PayPal - The safer, easier way to pay online!"
                               alt="Bouton Faites un don avec PayPal"/>
                        <img alt="" border="0" src="https://www.paypal.com/fr_FR/i/scr/pixel.gif" width="1"
                             height="1"/>
                    </form>
                </div>
            </li>
        </ul>
    </div>
</div>
<div id="content" style="padding: 0 95px 0 95px">
    <div id="header">
        <div id="header_logo" style="float: left;">
            <div id="logo" onClick="parent.location='/'">&nbsp;</div>
        </div>
    </div>
    <div id="stat" style="float: right">
        <div style="text-align: center"><img src="/static/img/loading.gif"></div>
    </div>
    <div id="body" style="padding-bottom: 100px;">{{ body }}</div>
</div>
{{ bottom_menu }}
</body>
</html>